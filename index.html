<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Form v1.4</title>

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>
body {
  font-family: sans-serif;
  background: linear-gradient(135deg,#4facfe,#00f2fe);
  margin:0;
  padding:20px;
}
.card {
  background:#fff;
  border-radius:16px;
  padding:20px;
  max-width:420px;
  margin:auto;
}
h2 { text-align:center; }
label { margin-top:10px; display:block; font-weight:bold; }
input, select, button {
  width:100%;
  padding:12px;
  margin-top:5px;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:16px;
}
button {
  background:#4facfe;
  color:#fff;
  border:none;
  margin-top:20px;
}
button:disabled { opacity:0.6; }
#summary { display:none; }
.loading {
  text-align:center;
  color:#fff;
}
</style>
</head>

<body>

<div class="card" id="formBox">
  <h2>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h2>

  <p><strong>LINE :</strong> <span id="displayName">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span></p>

  <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
  <input id="fullname" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">

  <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
  <input id="phone" type="tel" inputmode="numeric" maxlength="10">

  <label>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
  <select id="activity"></select>

  <label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
  <select id="item"></select>

  <button id="saveBtn" onclick="submitForm()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
</div>

<div class="card" id="summary">
  <h2>‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</h2>
  <p id="sumText"></p>
  <button onclick="resetForm()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà</button>
</div>

<p class="loading" id="loading" style="display:none;">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...</p>

<script>
const LIFF_ID = "2008940385-hkDtMTsg";
const GAS_URL = "https://script.google.com/macros/s/AKfycbzHGWEA9JYbd1e9-cGnod10qrWuy-hz39IEDd1DhjkCa8bRP-D4qVLkGXNQbV2dcjNI/exec";

let lineProfile = {};
let activityMap = {};

async function init() {
  await liff.init({ liffId: LIFF_ID });

  if (!liff.isLoggedIn()) {
    liff.login();
    return;
  }

  const profile = await liff.getProfile();
  lineProfile = profile;
  document.getElementById("displayName").innerText = profile.displayName;

  loadActivity();
}

function loadActivity() {
  fetch(GAS_URL + "?mode=activity")
    .then(res => res.json())
    .then(data => {
      activityMap = data;
      const act = document.getElementById("activity");
      act.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° --</option>';
      Object.keys(data).forEach(a => {
        act.innerHTML += `<option value="${a}">${a}</option>`;
      });
    });
}

document.getElementById("activity").onchange = function() {
  const items = activityMap[this.value] || [];
  const item = document.getElementById("item");
  item.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ --</option>';
  items.forEach(i => {
    item.innerHTML += `<option value="${i}">${i}</option>`;
  });
};

function submitForm() {
  document.getElementById("loading").style.display = "block";
  document.getElementById("saveBtn").disabled = true;

  const data = {
    userId: lineProfile.userId,
    displayName: lineProfile.displayName,
    profilename: lineProfile.pictureUrl, // üëà ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏π‡∏õ ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á
    inputName: document.getElementById("fullname").value,
    phone: document.getElementById("phone").value,
    activity: document.getElementById("activity").value,
    item: document.getElementById("item").value
  };

  fetch(GAS_URL, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify(data)
  })
  .then(res => res.json())
  .then(r => {
    document.getElementById("loading").style.display = "none";
    if (r.success) {
      document.getElementById("formBox").style.display = "none";
      document.getElementById("summary").style.display = "block";
      document.getElementById("sumText").innerText =
        `${data.inputName}\n${data.activity} - ${data.item}`;
    } else {
      alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      document.getElementById("saveBtn").disabled = false;
    }
  });
}

function resetForm() {
  location.reload();
}

init();
</script>
</body>
</html>
